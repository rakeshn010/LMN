{% extends "base.html" %}

{% block title %}Client Dashboard - LMN Industries{% endblock %}

{% block content %}
<section class="section" style="margin-top: 120px; background: #F8FAFC; min-height: 100vh;">
    <div class="container">
        <!-- Header with Profile -->
        <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div>
                <h1 style="font-size: 2rem; color: var(--primary-blue); margin-bottom: 5px;">Welcome back, {{ current_user.company_name or 'Client' }}!</h1>
                <p style="color: var(--metallic-grey); font-size: 1rem;">{{ current_user.email }}</p>
                <p style="color: var(--metallic-grey); font-size: 0.9rem; margin-top: 5px;">üìç {{ current_user.country or 'Not specified' }}</p>
            </div>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="{{ url_for('quote_calculator') }}" class="btn-primary" style="padding: 12px 30px;">New Quote Request</a>
                <a href="{{ url_for('contact') }}" class="btn-secondary" style="padding: 12px 30px;">Contact Support</a>
                <a href="{{ url_for('client_logout') }}" style="padding: 12px 30px; background: #EF4444; color: white; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s;">Logout</a>
            </div>
        </div>
        
        <!-- Statistics Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
            <div style="background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue)); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(26, 54, 93, 0.3);">
                <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 8px;">Total Orders</div>
                <div style="font-size: 2.5rem; font-weight: 800;">{{ orders|length }}</div>
            </div>
            <div style="background: linear-gradient(135deg, #10B981, #059669); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);">
                <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 8px;">In Production</div>
                <div style="font-size: 2.5rem; font-weight: 800;">{{ orders|selectattr('status', 'equalto', 'processing')|list|length }}</div>
            </div>
            <div style="background: linear-gradient(135deg, #F59E0B, #D97706); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
                <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 8px;">Quote Requests</div>
                <div style="font-size: 2.5rem; font-weight: 800;">{{ quotes|length }}</div>
            </div>
            <div style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
                <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 8px;">Delivered</div>
                <div style="font-size: 2.5rem; font-weight: 800;">{{ orders|selectattr('status', 'equalto', 'delivered')|list|length }}</div>
            </div>
        </div>
        
        <!-- Tabs Navigation -->
        <div style="background: white; border-radius: 12px 12px 0 0; padding: 0; margin-bottom: 0; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <div style="display: flex; border-bottom: 2px solid #E5E7EB;">
                <button onclick="showTab('orders')" id="ordersTab" style="flex: 1; padding: 20px; background: none; border: none; font-size: 1.1rem; font-weight: 600; color: var(--primary-blue); border-bottom: 3px solid var(--primary-blue); cursor: pointer;">Orders</button>
                <button onclick="showTab('quotes')" id="quotesTab" style="flex: 1; padding: 20px; background: none; border: none; font-size: 1.1rem; font-weight: 600; color: var(--metallic-grey); cursor: pointer;">Quote Requests</button>
                <button onclick="showTab('profile')" id="profileTab" style="flex: 1; padding: 20px; background: none; border: none; font-size: 1.1rem; font-weight: 600; color: var(--metallic-grey); cursor: pointer;">Profile</button>
            </div>
        </div>
        
        <!-- Orders Tab -->
        <div id="ordersContent" style="background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h2 style="font-size: 1.5rem; color: var(--primary-blue); margin-bottom: 25px;">Your Orders</h2>
            {% if orders %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #F8FAFC;">
                        <tr>
                            <th style="padding: 15px; text-align: left; font-weight: 600; color: var(--primary-blue);">Order #</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600; color: var(--primary-blue);">Description</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600; color: var(--primary-blue);">Status</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600; color: var(--primary-blue);">Amount</th>
                            <th style="padding: 15px; text-align: left; font-weight: 600; color: var(--primary-blue);">Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr style="border-bottom: 1px solid #E5E7EB;">
                            <td style="padding: 15px; font-weight: 600;">{{ order.order_number }}</td>
                            <td style="padding: 15px;">{{ order.description[:50] }}...</td>
                            <td style="padding: 15px;">
                                <span style="padding: 6px 16px; border-radius: 20px; font-size: 0.875rem; font-weight: 600;
                                    {% if order.status == 'processing' %}background: #DBEAFE; color: #1E40AF;
                                    {% elif order.status == 'shipped' %}background: #FEF3C7; color: #92400E;
                                    {% elif order.status == 'delivered' %}background: #D1FAE5; color: #065F46;
                                    {% else %}background: #F3F4F6; color: #374151;{% endif %}">
                                    {{ order.status|title }}
                                </span>
                            </td>
                            <td style="padding: 15px; font-weight: 600;">${{ "%.2f"|format(order.amount) }}</td>
                            <td style="padding: 15px;">{{ order.created_at.strftime('%b %d, %Y') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="background: #F8FAFC; padding: 60px; border-radius: 12px; text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 20px;">üì¶</div>
                <p style="font-size: 1.2rem; color: var(--metallic-grey); margin-bottom: 30px;">No orders yet</p>
                <a href="{{ url_for('quote_calculator') }}" class="btn-primary">Request Your First Quote</a>
            </div>
            {% endif %}
        </div>
        
        <!-- Quotes Tab -->
        <div id="quotesContent" style="display: none; background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h2 style="font-size: 1.5rem; color: var(--primary-blue); margin-bottom: 25px;">Your Quote Requests</h2>
            {% if quotes %}
            <div style="display: grid; gap: 20px;">
                {% for quote in quotes %}
                <div style="border: 2px solid #E5E7EB; border-radius: 12px; padding: 25px; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--primary-blue)'" onmouseout="this.style.borderColor='#E5E7EB'">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h3 style="font-size: 1.2rem; color: var(--primary-blue); margin-bottom: 5px;">Quote #{{ quote.id }}</h3>
                            <p style="color: var(--metallic-grey); font-size: 0.9rem;">{{ quote.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                        </div>
                        <span style="padding: 6px 16px; border-radius: 20px; font-size: 0.875rem; font-weight: 600;
                            {% if quote.status == 'pending' %}background: #FEF3C7; color: #92400E;
                            {% elif quote.status == 'approved' %}background: #D1FAE5; color: #065F46;
                            {% else %}background: #F3F4F6; color: #374151;{% endif %}">
                            {{ quote.status|title }}
                        </span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        <div>
                            <p style="font-size: 0.85rem; color: var(--metallic-grey); margin-bottom: 3px;">Material</p>
                            <p style="font-weight: 600;">{{ quote.material|title }}</p>
                        </div>
                        <div>
                            <p style="font-size: 0.85rem; color: var(--metallic-grey); margin-bottom: 3px;">Quantity</p>
                            <p style="font-weight: 600;">{{ quote.quantity }} units</p>
                        </div>
                        <div>
                            <p style="font-size: 0.85rem; color: var(--metallic-grey); margin-bottom: 3px;">Estimated Price</p>
                            <p style="font-weight: 600; color: #10B981;">${{ "%.2f"|format(quote.estimated_price) }}</p>
                        </div>
                    </div>
                    {% if quote.description %}
                    <p style="color: var(--metallic-grey); font-size: 0.95rem; margin-top: 10px;">{{ quote.description[:100] }}...</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="background: #F8FAFC; padding: 60px; border-radius: 12px; text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 20px;">üí¨</div>
                <p style="font-size: 1.2rem; color: var(--metallic-grey); margin-bottom: 30px;">No quote requests yet</p>
                <a href="{{ url_for('quote_calculator') }}" class="btn-primary">Request a Quote</a>
            </div>
            {% endif %}
        </div>
        
        <!-- Profile Tab -->
        <div id="profileContent" style="display: none; background: white; padding: 30px; border-radius: 0 0 12px 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h2 style="font-size: 1.5rem; color: var(--primary-blue); margin-bottom: 25px;">Your Profile</h2>
            <div style="max-width: 600px;">
                <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #E5E7EB;">
                    <p style="font-size: 0.9rem; color: var(--metallic-grey); margin-bottom: 5px;">Company Name</p>
                    <p style="font-size: 1.1rem; font-weight: 600;">{{ current_user.company_name or 'Not specified' }}</p>
                </div>
                <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #E5E7EB;">
                    <p style="font-size: 0.9rem; color: var(--metallic-grey); margin-bottom: 5px;">Email Address</p>
                    <p style="font-size: 1.1rem; font-weight: 600;">{{ current_user.email }}</p>
                </div>
                <div style="margin-bottom: 25px; padding-bottom: 25px; border-bottom: 1px solid #E5E7EB;">
                    <p style="font-size: 0.9rem; color: var(--metallic-grey); margin-bottom: 5px;">Country</p>
                    <p style="font-size: 1.1rem; font-weight: 600;">{{ current_user.country or 'Not specified' }}</p>
                </div>
                <div style="margin-bottom: 25px;">
                    <p style="font-size: 0.9rem; color: var(--metallic-grey); margin-bottom: 5px;">Member Since</p>
                    <p style="font-size: 1.1rem; font-weight: 600;">{{ current_user.created_at.strftime('%B %d, %Y') }}</p>
                </div>
                <div style="margin-top: 30px;">
                    <a href="{{ url_for('contact') }}" class="btn-primary">Update Profile Information</a>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
function showTab(tabName) {
    // Hide all content
    document.getElementById('ordersContent').style.display = 'none';
    document.getElementById('quotesContent').style.display = 'none';
    document.getElementById('profileContent').style.display = 'none';
    
    // Reset all tab buttons
    document.getElementById('ordersTab').style.color = 'var(--metallic-grey)';
    document.getElementById('ordersTab').style.borderBottom = 'none';
    document.getElementById('quotesTab').style.color = 'var(--metallic-grey)';
    document.getElementById('quotesTab').style.borderBottom = 'none';
    document.getElementById('profileTab').style.color = 'var(--metallic-grey)';
    document.getElementById('profileTab').style.borderBottom = 'none';
    
    // Show selected content and highlight tab
    if (tabName === 'orders') {
        document.getElementById('ordersContent').style.display = 'block';
        document.getElementById('ordersTab').style.color = 'var(--primary-blue)';
        document.getElementById('ordersTab').style.borderBottom = '3px solid var(--primary-blue)';
    } else if (tabName === 'quotes') {
        document.getElementById('quotesContent').style.display = 'block';
        document.getElementById('quotesTab').style.color = 'var(--primary-blue)';
        document.getElementById('quotesTab').style.borderBottom = '3px solid var(--primary-blue)';
    } else if (tabName === 'profile') {
        document.getElementById('profileContent').style.display = 'block';
        document.getElementById('profileTab').style.color = 'var(--primary-blue)';
        document.getElementById('profileTab').style.borderBottom = '3px solid var(--primary-blue)';
    }
}
</script>
{% endblock %}
